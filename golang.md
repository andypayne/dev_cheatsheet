# Go Programming Notes

## Build an executable
```zsh
go build go_source_file.go
```


## Initialize a module

### 1. Run `go mod init`
```zsh
go mod init github.com/andypayne/goproject
```

### 2. Create `main.go`
Something like:
```go
package main

import "fmt"

func main() {
  fmt.Println("Hello from goproject")
}
```

### 3. Run it
```zsh
go run github.com/andypayne/goproject
```


## Help Documentation

```zsh
go doc json.Decoder.decode
```


## Unmarshalling structs from JSON

Use a [JSON-to-Go Converter](https://mholt.github.io/json-to-go/), and hand tune
the results. More info and examples are in [this article](https://mariadesouza.com/2017/09/07/custom-unmarshal-json-in-golang/).

Example json:
```json
{
  "title": "My article",
  "author_id": "123",
  "published_at": 1592230218,
  "topics": [
    {
      "name": "cats",
      "relevance": 1
    },
    {
      "name": "dogs",
      "relevance": 2
    },
    {
      "name": "rain",
      "relevance": 10,
      "main": true
    }
  ]
}
```

The resulting struct definition:
```go
type AutoGenerated struct {
  Title       string `json:"title"`
  AuthorID    string `json:"author_id"`
  PublishedAt int    `json:"published_at"`
  Topics      []struct {
    Name      string `json:"name"`
    Relevance int    `json:"relevance"`
    Main      bool   `json:"main,omitempty"`
  } `json:"topics"`
}
```

Or without inline type definitions, so `Topics` is defined separately:
```go
type AutoGenerated struct {
  Title       string   `json:"title"`
  AuthorID    string   `json:"author_id"`
  PublishedAt int      `json:"published_at"`
  Topics      []Topics `json:"topics"`
}
type Topics struct {
  Name      string `json:"name"`
  Relevance int    `json:"relevance"`
  Main      bool   `json:"main,omitempty"`
}
```


## vim-go

### goimports

[goimports](https://godoc.org/golang.org/x/tools/cmd/goimports) is a tool that automatically updates imports to synchronize with usage in the code. It's quite useful, but there is an issue with database drivers when using `"database/sql"`. Database drivers need to be imported, but the import is not referenced directly in your code. So `goimports` happily removes it when the file is saved. There are two ways I've found to override this behavior.

Option 1 - add a reference to the library (cumbersome):
```golang
import (
  ...
  "github.com/lib/pq"
)

...

var happyGoImports pq.StringArray
fmt.Println(happyGoImports)
```

Option 2 - add an underscore before the import (better):
```golang
import (
  ...
  _ "github.com/lib/pq"
)

...
```

